name: Borsa Botu

on:
  schedule:
    - cron: '*/30 * * * *' # <-- DÜZELTME: Artık 30 dakikada bir çalışacak
  workflow_dispatch: # Elle tetiklemek için buton

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Depoyu Çek
        uses: actions/checkout@v3

      - name: Python Kurulumu (3.11)
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Kütüphaneleri Yükle
        run: |
          pip install -r requirements.txt

      # ADIM 1: Anahtarı JSON dosyasına dök (Yedek)
      - name: Firebase Anahtarını Oluştur
        env:
          # BURASI ÖNEMLİ: Senin "FIREBASE_CREDENTIALS" şifreni alıp
          # kodun beklediği "FIREBASE_KEY" değişkenine atıyoruz.
          FIREBASE_KEY: ${{ secrets.FIREBASE_CREDENTIALS }}
        run: |
          if [ -z "$FIREBASE_KEY" ]; then
            echo "::error::HATA: FIREBASE_CREDENTIALS Secret'ı boş veya bulunamadı!"
            exit 1
          fi
          # Dosyayı oluştur
          echo "$FIREBASE_KEY" > firebase_key.json
          echo "✅ firebase_key.json dosyası oluşturuldu."

      # ADIM 2: Botu Çalıştır
      - name: Botu Çalıştır
        env:
          # Koda anahtarı doğrudan da veriyoruz (Garanti olsun)
          FIREBASE_KEY: ${{ secrets.FIREBASE_CREDENTIALS }}
          CMC_API_KEY: ${{ secrets.CMC_API_KEY }}
        run: python bot.py
